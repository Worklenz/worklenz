"use strict";(self.webpackChunkworklenz=self.webpackChunkworklenz||[]).push([[945],{83945:(he,z,a)=>{a.r(z),a.d(z,{RptAllocationModule:()=>ce});var C=a(96814),v=a(35420),g=a(15861),T=a(69649),w=a(71993),P=a(63019),J=a(16676),s=a.n(J),p=a(21406),e=a(65879),O=a(90586),F=a(16196),N=a(69342),Q=a(42012),A=a(63106),x=a(62595),k=a(48128),y=a(24139),b=a(96109),Z=a(8083),U=a(10095),u=a(92574),_=a(73460),h=a(62787),S=a(42840),I=a(70855),L=a(41958),D=a(62612),j=a(20824),M=a(60804),f=a(60095),R=a(33640),Y=a(76271),H=a(9172);function $(o,c){if(1&o&&(e.TgZ(0,"button",24),e._uU(1," Teams "),e._UZ(2,"span",25),e.qZA()),2&o){const r=e.oxw(),n=e.MAs(7);e.Q6J("nzDropdownMenu",n)("nzClickHide",!1)("nzLoading",r.loadingTeams)("nzTrigger","click")}}function B(o,c){if(1&o&&(e.TgZ(0,"button",24),e._uU(1," Categories "),e._UZ(2,"span",25),e.qZA()),2&o){const r=e.oxw(),n=e.MAs(18);e.Q6J("nzDropdownMenu",n)("nzClickHide",!1)("nzLoading",r.loadingCategories)("nzTrigger","click")}}function K(o,c){if(1&o&&(e.TgZ(0,"button",24),e._uU(1," Projects "),e._UZ(2,"span",25),e.qZA()),2&o){const r=e.oxw(),n=e.MAs(31);e.Q6J("nzDropdownMenu",n)("nzClickHide",!1)("nzLoading",r.loadingProjects)("nzTrigger","click")}}function G(o,c){if(1&o){const r=e.EpF();e.TgZ(0,"li",8),e.NdJ("nzCheckedChange",function(t){const l=e.CHM(r).$implicit;return e.KtG(l.selected=t)})("nzCheckedChange",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.checkTeam())}),e._uU(1),e.qZA()}if(2&o){const r=c.$implicit;e.Q6J("nzChecked",r.selected),e.xp6(1),e.hij(" ",r.name," ")}}function W(o,c){if(1&o){const r=e.EpF();e.TgZ(0,"li",8),e.NdJ("nzCheckedChange",function(t){const l=e.CHM(r).$implicit;return e.KtG(l.selected=t)})("nzCheckedChange",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.checkCategory())}),e.TgZ(1,"div",26)(2,"div")(3,"span",27),e._UZ(4,"nz-badge",28),e.qZA()()()()}if(2&o){const r=c.$implicit;e.Q6J("nzChecked",r.selected),e.xp6(4),e.Q6J("nzColor",r.color_code)("nzText",r.name)}}function E(o,c){if(1&o){const r=e.EpF();e.TgZ(0,"li",8),e.NdJ("nzCheckedChange",function(t){const l=e.CHM(r).$implicit;return e.KtG(l.selected=t)})("nzCheckedChange",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.checkProject())}),e.TgZ(1,"div",26)(2,"div")(3,"span",29),e._uU(4),e.qZA()()()()}if(2&o){const r=c.$implicit;e.Q6J("nzChecked",r.selected),e.xp6(4),e.Oqu(r.name)}}function V(o,c){1&o&&e._UZ(0,"nz-empty",30),2&o&&e.Q6J("nzNotFoundContent","No time logs found!")}function X(o,c){if(1&o&&(e.TgZ(0,"div",35),e._uU(1),e.qZA()),2&o){const r=c.$implicit;e.xp6(1),e.hij(" ",r.name," ")}}function q(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"div",31),e._UZ(2,"div",32),e.YNc(3,X,2,1,"div",33),e.TgZ(4,"div",34),e._uU(5,"Total"),e.qZA()(),e.BQk()),2&o){const r=e.oxw();e.xp6(3),e.Q6J("ngForOf",r.members)}}function ee(o,c){if(1&o&&(e.TgZ(0,"div",43),e._uU(1),e.qZA()),2&o){const r=c.$implicit;e.xp6(1),e.hij(" ",r.time_logged," ")}}function te(o,c){if(1&o&&(e.TgZ(0,"div",37)(1,"div",32),e._UZ(2,"span",38),e.ALo(3,"safeString"),e.ALo(4,"safeString"),e.TgZ(5,"span",39),e._uU(6),e.qZA(),e.TgZ(7,"div",27),e._UZ(8,"nz-progress",40),e.ALo(9,"safeString"),e.qZA()(),e.YNc(10,ee,2,1,"div",41),e.TgZ(11,"div",42),e._uU(12),e.qZA()()),2&o){const r=c.$implicit;e.xp6(2),e.Udp("color",r.status_color_code),e.Q6J("nzType",e.lcZ(3,11,r.status_icon))("nzTooltipTitle",e.lcZ(4,13,r.status_name)),e.xp6(4),e.Oqu(r.name),e.xp6(2),e.Q6J("nzPercent",r.progress)("nzStrokeColor",e.lcZ(9,15,r.color_code))("nzTooltipTitle",r.completed_tasks_count+" of "+r.all_tasks_count)("nzSize","small"),e.xp6(2),e.Q6J("ngForOf",r.time_logs),e.xp6(2),e.Oqu(r.total)}}function ne(o,c){if(1&o&&(e.ynx(0),e.YNc(1,te,13,17,"div",36),e.BQk()),2&o){const r=e.oxw();e.xp6(1),e.Q6J("ngForOf",r.projects)}}function oe(o,c){if(1&o&&(e.TgZ(0,"div",47),e._uU(1),e.qZA()),2&o){const r=c.$implicit;e.xp6(1),e.hij(" ",r.total_time," ")}}function ie(o,c){if(1&o&&(e.TgZ(0,"div",44)(1,"div",45),e._uU(2,"Total"),e.qZA(),e.YNc(3,oe,2,1,"div",46),e._UZ(4,"div",42),e.qZA()),2&o){const r=e.oxw();e.xp6(3),e.Q6J("ngForOf",r.members)}}const re=[{path:"",component:(()=>{var o;class c{constructor(n,t,i,l,d){this.app=n,this.api=t,this.cdr=i,this.exportApi=l,this.service=d,this.loadingProjects=!1,this.loadingCategories=!1,this.loadingTeams=!1,this.loading=!1,this.selectAllTeams=!0,this.selectAllProjects=!0,this.selectAllCategories=!0,this.selectNoCategory=!0,this.isDurationLabelSelected=!0,this.categorySearchText=null,this.teamSearchText=null,this.projectSearchText=null,this.projects=[],this.members=[],this.teamsDropDown=[],this.projectsDropdown=[],this.categoriesDropdown=[],this.selectAll=!0,this.app.setTitle("Reporting - Allocation"),(0,P.T)(this.service.onDurationChange,this.service.onDateRangeChange,this.service.onIncludeToggleChange).pipe((0,w.sL)()).subscribe(()=>{this.getAllocationData()})}ngOnInit(){this.getTeams()}getSelectedTeamIds(){return this.teamsDropDown.filter(i=>i.selected).map(i=>i.id)||[]}getSelectedCategories(){return this.categoriesDropdown.filter(i=>i.selected).map(i=>i.id)||[]}getSelectedProjectIds(){return this.projectsDropdown.filter(i=>i.selected).map(i=>i.id)||[]}selectAllCategoriesChecked(n){if(n){this.selectNoCategory=!0;for(const t of this.categoriesDropdown)t.selected=!0;this.refreshProjects(),this.cdr.markForCheck()}else{this.selectNoCategory=!1;for(const t of this.categoriesDropdown)t.selected=!1;this.refreshProjects(),this.cdr.markForCheck()}}getCategories(n){var t=this;return(0,g.Z)(function*(){try{t.loadingCategories=!0;const i=yield t.api.getCategories(n);i.done&&(t.categoriesDropdown=i.body),t.loadingCategories=!1,t.cdr.markForCheck()}catch{t.loadingCategories=!1,t.cdr.markForCheck()}})()}setDatesForKeys(){var n=this;return(0,g.Z)(function*(){if(n.service.getDuration()?.key){const t=n.service.getDuration()?.key,i=s()();switch(t){case p.WD:const l=s()().subtract(1,"days");n.service.setDateRange([l.toString(),l.toString()]);break;case p.ao:const d=s()().subtract(1,"weeks");n.service.setDateRange([d.toString(),i.toString()]);break;case p.ly:const m=s()().subtract(1,"months");n.service.setDateRange([m.toString(),i.toString()]);break;case p.o9:const se=s()().subtract(3,"months");n.service.setDateRange([se.toString(),i.toString()]);break;case p.$U:const de=s()().subtract(1,"weeks").startOf("week"),ge=s()().subtract(1,"weeks").endOf("week");n.service.setDateRange([de.toString(),ge.toString()]);break;case p.lI:const pe=s()().subtract(1,"month").startOf("month"),me=s()().subtract(1,"month").endOf("month");n.service.setDateRange([pe.toString(),me.toString()])}}})()}getAllocationData(){var n=this;return(0,g.Z)(function*(){try{n.loading=!0,n.isDurationLabelSelected&&(yield n.setDatesForKeys());const t=n.getSelectedTeamIds(),i=n.getSelectedProjectIds(),l=n.service.getDuration()?.key,d={teams:t,projects:i,duration:l,date_range:n.service.getDateRange(),archived:n.service.getIncludeToggle()},m=yield n.api.getAllocationData(d,n.service.getIncludeToggle());m.done&&(n.members=m.body.users,n.projects=m.body.projects),n.loading=!1}catch{n.loading=!1}n.cdr.markForCheck()})()}refreshCategories(){var n=this;return(0,g.Z)(function*(){yield n.getCategories(n.getSelectedTeamIds()),n.refreshProjects()})()}refreshProjects(){this.getProjects(this.getSelectedTeamIds(),this.getSelectedCategories())}getProjects(n,t){var i=this;return(0,g.Z)(function*(){try{i.loadingProjects=!0;const l=yield i.api.getAllocationProjects(n,t,i.selectNoCategory);l.done&&(i.projectsDropdown=l.body,i.getAllocationData()),i.loadingProjects=!1}catch{i.loadingProjects=!1}i.cdr.markForCheck()})()}getTeams(){var n=this;return(0,g.Z)(function*(){try{n.loadingTeams=!0;const t=yield n.api.getOverviewTeams();if(t.done){n.loadingTeams=!1;const i=[];for(const l of t.body)i.push({selected:!0,name:l.name,id:l.id});n.teamsDropDown=i,n.refreshCategories(),n.cdr.markForCheck()}}catch(t){(0,T.tu)(t),n.loadingTeams=!1}})()}export(){var n=this;return(0,g.Z)(function*(){try{const t=n.getSelectedTeamIds(),i=n.getSelectedProjectIds();n.isDurationLabelSelected&&(yield n.setDatesForKeys());const l=n.service.getDuration()?.key;n.service.getDateRange(),n.service.getIncludeToggle(),n.exportApi.exportAllocation(n.service.getIncludeToggle(),t,i,l,n.service.getDateRange())}catch(t){(0,T.tu)(t)}})()}checkTeam(){this.selectAllTeams=!1,this.refreshCategories()}checkCategory(){this.selectAllCategories=!1,this.refreshProjects()}checkProject(){this.selectAllProjects=!1,this.getAllocationData()}selectAllTeamsChecked(n){if(n){for(const t of this.teamsDropDown)t.selected=!0;this.refreshProjects(),this.cdr.markForCheck()}else{for(const t of this.teamsDropDown)t.selected=!1;this.refreshProjects(),this.cdr.markForCheck()}}selectAllProjectsChecked(n){if(n){for(const t of this.projectsDropdown)t.selected=!0;this.getAllocationData(),this.cdr.markForCheck()}else{for(const t of this.projectsDropdown)t.selected=!1;this.getAllocationData(),this.cdr.markForCheck()}}}return(o=c).\u0275fac=function(n){return new(n||o)(e.Y36(O.z),e.Y36(F.U),e.Y36(e.sBO),e.Y36(N.O),e.Y36(Q.m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["worklenz-rpt-allocation"]],decls:49,vars:26,consts:[[3,"title","isDurationLabelSelected","exportFile"],["nz-row",""],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzClickHide","nzLoading","nzTrigger",4,"nzSpaceItem"],["teamsDropdown","nzDropdownMenu"],["nz-menu","",1,"pt-0",2,"max-height","330px","overflow-y","auto"],[1,"px-3","py-2","sticky-top","bg-white"],["type","text","placeholder","Search by team name","nz-input","",3,"ngModel","ngModelChange"],["teamSearchInput",""],["nz-checkbox","","nz-menu-item","",1,"m-0","align-items-baseline",3,"nzChecked","nzCheckedChange"],["nz-menu-divider",""],["class","m-0 align-items-baseline","nz-checkbox","","nz-menu-item","",3,"nzChecked","nzCheckedChange",4,"ngFor","ngForOf"],["categorySelector","nzDropdownMenu"],["type","text","placeholder","Search by category name","nz-input","",3,"ngModel","ngModelChange"],["categorySearchInput",""],["projectsSelector","nzDropdownMenu"],["type","text","placeholder","Search by project name","nz-input","",3,"ngModel","ngModelChange"],["projectSearchInput",""],[3,"nzLoading","nzActive"],[1,"row-fix"],[1,"table-container","mt-3"],[1,"member-project-table"],[3,"nzNotFoundContent",4,"ngIf"],[4,"ngIf"],["class","table-row_ d-flex bottom-row",4,"ngIf"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzClickHide","nzLoading","nzTrigger"],["nz-icon","","nzType","caret-down"],[1,"d-flex","align-items-center","justify-content-center","user-select-none"],[1,"d-block"],[3,"nzColor","nzText"],["nz-typography","",1,"d-block"],[3,"nzNotFoundContent"],[1,"header-row","d-flex"],[1,"project-name"],["class","member-name f-500",4,"ngFor","ngForOf"],[1,"total-time","text-center"],[1,"member-name","f-500"],["class","table-row_ d-flex",4,"ngFor","ngForOf"],[1,"table-row_","d-flex"],["nz-icon","","nz-tooltip","",3,"nzType","nzTooltipTitle"],[1,"ms-1"],["nz-tooltip","",3,"nzPercent","nzStrokeColor","nzTooltipTitle","nzSize"],["class","member-time",4,"ngFor","ngForOf"],[1,"total-time"],[1,"member-time"],[1,"table-row_","d-flex","bottom-row"],[1,"project-name","bg-bold"],["class","member-total-time bg-bold",4,"ngFor","ngForOf"],[1,"member-total-time","bg-bold"]],template:function(n,t){if(1&n&&(e.TgZ(0,"worklenz-rpt-header",0),e.NdJ("isDurationLabelSelected",function(l){return t.isDurationLabelSelected=l})("exportFile",function(){return t.export()}),e.qZA(),e.TgZ(1,"div",1)(2,"nz-space"),e.YNc(3,$,3,4,"button",2),e.YNc(4,B,3,4,"button",2),e.YNc(5,K,3,4,"button",2),e.qZA()(),e.TgZ(6,"nz-dropdown-menu",null,3)(8,"ul",4)(9,"li",5)(10,"input",6,7),e.NdJ("ngModelChange",function(l){return t.teamSearchText=l}),e.qZA()(),e.TgZ(12,"li",8),e.NdJ("nzCheckedChange",function(l){return t.selectAllTeams=l})("nzCheckedChange",function(l){return t.selectAllTeamsChecked(l)}),e._uU(13,"Select all "),e.qZA(),e._UZ(14,"li",9),e.YNc(15,G,2,2,"li",10),e.ALo(16,"searchByName"),e.qZA()(),e.TgZ(17,"nz-dropdown-menu",null,11)(19,"ul",4)(20,"li",5)(21,"input",12,13),e.NdJ("ngModelChange",function(l){return t.categorySearchText=l}),e.qZA()(),e.TgZ(23,"li",8),e.NdJ("nzCheckedChange",function(l){return t.selectAllCategories=l})("nzCheckedChange",function(l){return t.selectAllCategoriesChecked(l)}),e._uU(24,"Select all "),e.qZA(),e._UZ(25,"li",9),e.TgZ(26,"li",8),e.NdJ("nzCheckedChange",function(l){return t.selectNoCategory=l})("nzCheckedChange",function(){return t.checkCategory()}),e._uU(27," No Category "),e.qZA(),e.YNc(28,W,5,3,"li",10),e.ALo(29,"searchByName"),e.qZA()(),e.TgZ(30,"nz-dropdown-menu",null,14)(32,"ul",4)(33,"li",5)(34,"input",15,16),e.NdJ("ngModelChange",function(l){return t.projectSearchText=l}),e.qZA()(),e.TgZ(36,"li",8),e.NdJ("nzCheckedChange",function(l){return t.selectAllProjects=l})("nzCheckedChange",function(l){return t.selectAllProjectsChecked(l)}),e._uU(37,"Select all "),e.qZA(),e._UZ(38,"li",9),e.YNc(39,E,5,2,"li",10),e.ALo(40,"searchByName"),e.qZA()(),e.TgZ(41,"nz-skeleton",17)(42,"div",18)(43,"div",19)(44,"div",20),e.YNc(45,V,1,1,"nz-empty",21),e.YNc(46,q,6,1,"ng-container",22),e.YNc(47,ne,2,1,"ng-container",22),e.YNc(48,ie,5,1,"div",23),e.qZA()()()()),2&n){const i=e.MAs(11),l=e.MAs(22),d=e.MAs(35);e.Q6J("title","Time Sheet"),e.xp6(10),e.Q6J("ngModel",t.teamSearchText),e.xp6(2),e.Q6J("nzChecked",t.selectAllTeams),e.xp6(3),e.Q6J("ngForOf",e.xi3(16,17,t.teamsDropDown,i.value)),e.xp6(6),e.Q6J("ngModel",t.categorySearchText),e.xp6(2),e.Q6J("nzChecked",t.selectAllCategories),e.xp6(3),e.Q6J("nzChecked",t.selectNoCategory),e.xp6(2),e.Q6J("ngForOf",e.xi3(29,20,t.categoriesDropdown,l.value)),e.xp6(6),e.Q6J("ngModel",t.projectSearchText),e.xp6(2),e.Q6J("nzChecked",t.selectAllProjects),e.xp6(3),e.Q6J("ngForOf",e.xi3(40,23,t.projectsDropdown,d.value)),e.xp6(2),e.Q6J("nzLoading",t.loading)("nzActive",!0),e.xp6(4),e.Q6J("ngIf",!t.loading&&!t.members.length&&!t.projects.length),e.xp6(1),e.Q6J("ngIf",t.members.length),e.xp6(1),e.Q6J("ngIf",t.projects.length),e.xp6(1),e.Q6J("ngIf",t.members.length&&t.projects.length)}},dependencies:[C.sg,C.O5,A.I,x.Ls,k.M,y.ng,b.SY,Z.ZU,U.SK,u.NU,u.$1,_.wO,_.r9,_.YV,h.cm,h.RR,h.wA,S.ix,I.w,L.dQ,D.Ie,j.Zp,M.p9,f.Fj,f.JJ,f.On,R.x7,Y.m,H.g],styles:[".project-name[_ngcontent-%COMP%]{width:200px;position:sticky;left:0;background:white;padding:16px 8px 16px 12px;border-left:1px solid #f5f5f5;border-right:1px solid #f5f5f5;border-bottom:1px solid #f5f5f5}.member-time[_ngcontent-%COMP%], .member-name[_ngcontent-%COMP%], .member-total-time[_ngcontent-%COMP%]{width:100px;border-right:1px solid #f5f5f5;padding:16px 6px}.member-time[_ngcontent-%COMP%]{font-size:13px;border-bottom:1px solid #f5f5f5;color:hwb(0 0% 100%/.65);text-align:center;display:flex;align-items:center;justify-content:center}.member-name[_ngcontent-%COMP%]{border-bottom:1px solid #f5f5f5;border-top:1px solid #f5f5f5;text-overflow:ellipsis;overflow:hidden}.header-row[_ngcontent-%COMP%], .table-row_[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}.header-row[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:9}.header-row[_ngcontent-%COMP%]   .project-name[_ngcontent-%COMP%]{border-left:none!important}.total-time[_ngcontent-%COMP%]{width:120px;position:sticky;right:0;background:#f8f7f9;text-align:center;font-weight:500;padding:16px 12px;border-bottom:1px solid #f1f1f1;display:flex;align-items:center;justify-content:center}.bg-bold[_ngcontent-%COMP%]{background:#f8f7f9;font-weight:500}.f-500[_ngcontent-%COMP%]{font-weight:500}.member-project-table[_ngcontent-%COMP%]{overflow:auto;max-height:calc(100vh - 250px)}.border-top[_ngcontent-%COMP%]{border-top:1px solid #f0f0f0!important}.badge-custom[_ngcontent-%COMP%]{margin-top:-3px!important;margin-right:4px}.no-data-img-holder[_ngcontent-%COMP%]{width:100px;margin-top:42px}.bottom-row[_ngcontent-%COMP%]{position:sticky;bottom:0}"],changeDetection:0}),c})()}];let le=(()=>{var o;class c{}return(o=c).\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[v.Bz.forChild(re),v.Bz]}),c})();var ae=a(3599);let ce=(()=>{var o;class c{}return(o=c).\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[C.ez,le,A.I,x.PV,k.W,y.H0,b.cg,Z.ZJ,ae.U5,u.zf,h.b1,S.sL,D.Wr,j.o7,M.Xo,f.u5,R.mS]}),c})()}}]);